# Создание расщепленного платежа

## OpenAPI Specification

```yaml
openapi: 3.0.1
info:
  title: ''
  description: ''
  version: 1.0.0
paths:
  /payment:
    post:
      summary: Создание расщепленного платежа
      deprecated: false
      description: >-
        Пример запроса для расщепления платежа.


        Возможны следующие типы получателей (split\[\*\].type) при разделении
        платежа:  

        • account – перевод на р/с юридического лица (в recipient необходимо
        передать UIID банковских реквизитов (предоставляются со стороны
        Multicard);  

        • wallet – пополнение внутреннего кошелька Партнера. Аккумулированные на
        кошельке средства доступны к выводу на банковские карты, а также
        отправка средств на расчетный счет.


        Сумма значений amount в массиве split не должна превышать суммы оплаты
        за вычетом комиссии. К примеру, если сумма оплаты 1 000 сум, а комиссия
        составляет 2%, то общая сумма расщепления должна составлять 980 сум.


        В ответ возвращается {PaymentModel}
      tags:
        - Оплата на странице Партнера
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                card:
                  type: object
                  properties:
                    token:
                      type: string
                      description: |-
                        Max length:255
                        Токен карты для проведения платежных операций с картой
                  required:
                    - token
                  x-apidog-orders:
                    - token
                  x-apidog-ignore-properties: []
                amount:
                  type: integer
                  description: Сумма платежа в тийинах
                store_id:
                  type: integer
                  description: ID кассы Партнера в системе Multicard
                invoice_id:
                  type: string
                  description: >-
                    Max length:255

                    Любой идентификатор заказа в системе Партнера. Будет
                    возвращен в callback-запросе. Также по нему можно искать
                    платежи в кабинете мерчанта
                billing_id:
                  type: integer
                  description: Уникальный ID транзакции в системе Партнера
                callback_url:
                  type: string
                  description: URL для отправки callback-запроса
                ofd:
                  description: Данные для формирования фискального чека
                  $ref: '#/components/schemas/ofdRequest'
                split:
                  description: Объект с информацией о расщеплении
                  $ref: '#/components/schemas/splitRequest'
              required:
                - card
                - amount
                - store_id
                - invoice_id
              x-apidog-orders:
                - card
                - amount
                - store_id
                - invoice_id
                - billing_id
                - callback_url
                - ofd
                - split
              x-apidog-ignore-properties: []
            example:
              amount: 100000
              store_id: 6
              invoice_id: test
              billing_id: 1122334455
              callback_url: https://
              ofd:
                - qty: 1
                  vat: 12
                  price: 90000
                  mxik: '06401004002000000'
                  total: 90000
                  package_code: '1506113'
                  name: кроссовки men's low shoes
                  tin: '307578794'
                - qty: 1
                  vat: 0
                  price: 10000
                  mxik: '10107002001000000'
                  total: 10000
                  package_code: '1209885'
                  name: доставка заказа с маркетплейса
                  tin: '31105892390010'
              split:
                - type: account
                  recipient: 5378f655-ae41-11ee-97a8-005056b4367d
                  amount: 88000
                  details: 'Оплата товаров по заказу #123'
                - type: account
                  recipient: 7bd7ad8e-b2d5-11ee-97a8-005056b4367d
                  amount: 10000
                  details: 'Оплата за доставку по заказу #123'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: object
                properties: {}
                x-apidog-orders: []
                x-apidog-ignore-properties: []
              example: |-
                {
                    "success": true,
                    "data": {PaymentModel}
                }
          headers: {}
          x-apidog-name: PaymentModel
        '400':
          description: >-
            При попытке добавления карты с неправильным номером, или сроком
            действия система возвращает ошибку с кодом 400, и сообщает клиенту
            об ошибке
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Статус запроса
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        description: Кодовое сообщение
                      details:
                        type: string
                        description: Описание ошибки
                    required:
                      - code
                      - details
                    x-apidog-orders:
                      - code
                      - details
                    description: Ошибка
                    x-apidog-ignore-properties: []
                required:
                  - success
                  - error
                x-apidog-orders:
                  - success
                  - error
                x-apidog-ignore-properties: []
              example:
                success: false
                error:
                  code: ERROR_CARD_NOT_FOUND
                  details: Неверный номер карты или срок действия
          headers: {}
          x-apidog-name: 'Запрос с некорректным номером карты или срока действия '
        x-400:Ошибочная валидация:
          description: >-
            При отправке запроса с допущением ошибки валидации, возвращается
            ошибка с кодом 400
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Статус запроса
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        description: Кодовое сообщение
                      details:
                        type: string
                        description: Описание ошибки
                    required:
                      - code
                      - details
                    x-apidog-orders:
                      - code
                      - details
                    description: Ошибка
                    x-apidog-ignore-properties: []
                required:
                  - success
                  - error
                x-apidog-orders:
                  - success
                  - error
                x-apidog-ignore-properties: []
              example:
                success: false
                error:
                  code: ERROR_FIELDS
                  details: Неверный store_id
          headers: {}
          x-apidog-name: Ошибочная валидация
      security: []
      x-apidog-folder: Оплата на странице Партнера
      x-apidog-status: released
      x-run-in-apidog: https://app.apidog.com/web/project/1022226/apis/api-19729312-run
components:
  schemas:
    splitRequest:
      type: array
      items:
        type: object
        properties:
          type:
            type: string
            enum:
              - account
              - wallet
              - card
            x-apidog-enum:
              - value: account
                name: ''
                description: Расчетный счет
              - value: wallet
                name: ''
                description: Депозит приложения
              - value: card
                name: ''
                description: Банковская карта
            description: Тип получателя
          amount:
            type: integer
            description: Сумма платежа
          details:
            type: string
            description: Детали платежа
          recipient:
            type: string
            description: >-
              Получатель. Если type=account, то передается uuid банковских
              реквизитов. По-умолчанию подставляются банковские реквизиты
              мерчанта.
        x-apidog-orders:
          - type
          - amount
          - details
          - recipient
        required:
          - type
          - amount
          - details
        x-apidog-ignore-properties: []
      x-apidog-folder: ''
    ofdRequest:
      type: array
      items:
        type: object
        properties:
          qty:
            type: integer
            description: Количество единиц товара/услуги
          vat:
            type: integer
            description: НДС (%)
          price:
            type: integer
            description: Стоимость единицы товара в тийинах
          mxik:
            type: string
            description: ИКПУ из справочника tasnif.soliq.uz
          total:
            type: integer
            description: Общая сумма товаров с учетом количества без учета скидок в тийинах
          package_code:
            type: string
            description: Код упаковки из справочника tasnif.soliq.uz
          name:
            type: string
            description: Наименование товара/услуги
          tin:
            type: string
            description: ИНН компании
        x-apidog-orders:
          - qty
          - vat
          - price
          - mxik
          - total
          - package_code
          - name
          - tin
        required:
          - qty
          - price
          - mxik
          - package_code
          - name
        x-apidog-ignore-properties: []
      x-apidog-folder: ''
  securitySchemes:
    bearer:
      type: http
      scheme: bearer
servers: []
security:
  - bearer: []

```
