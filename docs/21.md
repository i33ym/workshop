# Оплата на странице Партнера

> В случае [привязки карты плательщика](#5b24565d-701d-4d8b-b41f-ed2f37feaf3d), допускается проведение списания через систему Партнера с помощью токена карты, либо путем передачи карточных данных (при наличие сертификата PCI DSS). С привязанных карт можно проводить как безакцептное списание, так и с подтверждением через SMS-код (OTP) - выбранный режим подтверждения транзакции зависит от настроек на стороне Multicard.

Транзакция проводится в два этапа:

1. Создание платежа. В ответе в поле uuid возвращается уникальный ID транзакции в системе Multicard. На данном этапе на карте не списываются и не блокируется средства.
    
2. Подтверждение платежа. Доступно двумя способами:
    
    1. Перенаправление пользователя по ссылке в поле checkout_url из ответа на создание платежа.
        
    2. Путем отправки [запроса на подтверждение платежа](#4db015c3-bf1a-4ea9-a570-dd8c2761c561). В URL необходимо передать полученный в первом запросе uuid-транзакции. Если включен режим безакцептного списания, то необходимо отправить пустое тело запроса, в противном случае - полученный пользователем SMS-код. По результатам исполнения данного запроса с карты клиента списываются средства.
        

### Описание модели платежной транзакции (PaymentModel)

| Поле | Описание | Тип |
| --- | --- | --- |
| uuid | Уникальный ID транзакции | string(36) |
| store_id | ID магазина партнера | integer |
| status | Статус транзакции. Смотри {StatusModel} | enum |
| ps | Платежная система/сервис | enum(uzcard, humo, visa, mastercard, payme, click, ..) |
| store_invoice_id | ID инвойса в системе партнера | string(255) |
| store_details | Детали платежа | string |
| card_token | Токен карты | string |
| card_pan | Маска карты | string |
| billing_id | Уникальный ID транзакции в системе Партнера | string(64) |
| phone | Последние 4 цифры номер телефона клиента | string(12) |
| split | Объект с информацией о расщеплении | object |
| device_details | Объект с информацией об устройстве клиента | object |
| commission_type | Тип комиссии за эквайринг. Up – комиссия взымается поверх переданной суммы (с клиента). Down – комиссия взымается с мерчанта | enum(up, down) |
| payment_amount | Сумма платежа в тийинах (копейках) | integer |
| total_amount | Сумма списания с карты клиента с учетом комиссии в тийинах | integer |
| commission_amount | Сумма комиссии в тийинах | integer |
| otp_hash | В случае необходимости подтверждения платежа не равен null | nullable string |
| ps_uniq_id | Уникальный идентификатор платежа в платежной системе (ref_num, rrn). Указывается в банковской выписке по карте | string |
| ps_response_code | Код ответа платежной системы | string |
| callback_message | Ответ из биллинга партнера (в случае интеграции с биллингом) | string |
| tax | Объект с информацией о фискальном чеке. Ссылка на чек в поле qr_url | object |
| refund_tax | Объект с информацией о возвратном фискальном чеке. Ссылка на чек в поле qr_url | object |
| receipt_url | Ссылка на квитанцию об оплате | string |
| payment_time | Время списания средств с карты клиента | datetime (Y-m-d H:i:s) |
| refund_time | Время возврата | datetime (Y-m-d H:i:s) |
| store | Объект с информацией о магазине партнера | object |
| checkout_url | Ссылка на страницу проведения платежа | string |
| clearing | Объект с информацией о платежном поручении по возмещению на расчетный счет мерчанта | object |

Пример ответа:

``` json
{
    "success": true,
    "data": {
        "status": "draft",
        "ps": "humo",
        "store_id": 6,
        "store_invoice_id": "RB25047997032",
        "store_details": {
            "NDECREE": "RB25047997032",
            "SERVICE_TYPE": "01"
        },
        "card_token": "66b1f7d3565baf001c384f39",
        "card_pan": "409784******3066",
        "phone": "*3929",
        "split": null,
        "multicard_user_id": null,
        "device_details": null,
        "kyc_data": null,
        "callback_url": null,
        "ofd": null,
        "commission_type": "down",
        "terminal_id": "18610VQW",
        "merchant_id": "01200000012000N",
        "payment_amount": 100000,
        "total_amount": 100000,
        "commission_amount": 1500,
        "id": 52311181,
        "uuid": "2b163e87-6d7e-11f0-9a1b-00505680eaf6",
        "ps_uniq_id": null,
        "ps_response_code": null,
        "callback_message": null,
        "payment_time": null,
        "fee_munis": null,
        "refund_time": null,
        "billing_id": null,
        "otp_hash": null,
        "clearing_id": null,
        "tax_receipt_id": null,
        "added_on": "2025-07-31 00:48:30",
        "application": {
            "id": 9,
            "application_id": "multicard_cron",
            "wallet_sum": null,
            "wallet_sender_account": null,
            "wallet_overdraft": 0,
            "wallet_contract_num": null,
            "otp_required": 0,
            "otp_gateway": null,
            "sms_nickname": null,
            "allow_bank_transaction": 1,
            "otp_length": 6,
            "official_name": "Multicard",
            "offer_url": null,
            "phone": null,
            "allow_balance": 0,
            "added_on": "2021-08-12 00:58:02",
            "updated_on": "2025-03-28 21:04:17"
        },
        "store": {
            "id": 6,
            "uuid": "5a394898-d5aa-11ee-a37f-00505680eaf6",
            "category_id": null,
            "merchant_id": 5,
            "note": "путевка (тест)",
            "logo": "https://checkout.multicard.uz/img/favicon.png",
            "color": null,
            "uzum_terminal": "{\n    \"terminal_id\": \"1fb0f2ee-9460-48de-8a5e-3c7c036b394c\",\n    \"merchant_id\": null,\n    \"commission_type\": \"down\",\n    \"commission\": 0,\n    \"interest\": \"0\"\n}",
            "callback_class": null,
            "view_fields": null,
            "tax_registration": 0,
            "tax_mxik": "10204001001000000",
            "tax_package_code": "1500169",
            "tax_commission_recipient_tin": "200799456",
            "budget_category_id": null,
            "repeatable": 0,
            "otp_required": 0,
            "active": 1,
            "sort": 0,
            "cashback": 0,
            "tg_chat_id": null,
            "qr_url": null,
            "bg_img": null,
            "merchant_account_id": null,
            "title": "Multicard",
            "merchant": {
                "id": 5,
                "name": "Тестовый мерчант (Multicard)",
                "tin": "307578794",
                "contract_id": null,
                "bank_account": "00981:29896000900000981002",
                "sender_account": {
                    "ps_external_fee_type": "down",
                    "allow_sms": true,
                    "ps_external_fee_amount": "1.5",
                    "disable_deeplink": true,
                    "sbp_terminal_id": "90C4F76700644424AEBD1249DA2866DB"
                }
            },
            "surcharge": {
                "humo": 0,
                "uzcard": 0,
                "payme": 0,
                "click": 0,
                "uzum": 0,
                "alif": 0,
                "xazna": 0,
                "anorbank": 0,
                "oson": 0,
                "beepul": 0,
                "road24": 0
            },
            "discount": {
                "humo": 0,
                "uzcard": 0,
                "payme": 0,
                "click": 0,
                "uzum": 0,
                "alif": 0,
                "xazna": 0,
                "anorbank": 0,
                "oson": 0,
                "beepul": 0
            },
            "contract": null,
            "merchant_account": null
        },
        "tax": null,
        "refund_tax": null,
        "ps_response_msg": null,
        "receipt_url": null,
        "invoice": null,
        "details": {
            "NDECREE": "RB25047997032",
            "SERVICE_TYPE": "01"
        },
        "clearing": [],
        "bank": null,
        "checkout_url": "https://checkout.multicard.uz/2b163e87-6d7e-11f0-9a1b-00505680eaf6"
    }
}

 ```

### Возможные статусы транзакции (StatusModel)

| **Статус** | **Описание** | **Конечный** |
| --- | --- | --- |
| draft | Транзакция создана, но еще не подтверждена | Нет |
| progress | Транзакция подтверждена, в процессе исполнения | Нет |
| billing | Авторизация успешна, попытка отправки запроса в биллинг Мерчанта | Нет |
| hold | Средства захолдированы (заблокированы) на карте плательщика | Нет |
| success | Успешно | Да |
| error | Ошибка при списании или при отправки запроса в биллинг Мерчанта | Да |
| revert | Осуществлен возврат средств на карту клиента | Да |

В случае [привязки карты плательщика](#5b24565d-701d-4d8b-b41f-ed2f37feaf3d), допускается проведение списания через систему Партнера с помощью токена карты, либо путем передачи карточных данных (при наличие сертификата PCI DSS). С привязанных карт можно проводить как безакцептное списание, так и с подтверждением через SMS-код (OTP) - выбранный режим подтверждения транзакции зависит от настроек на стороне Multicard.

Транзакция проводится в два этапа:

1. Создание платежа. В ответе в поле uuid возвращается уникальный ID транзакции в системе Multicard. На данном этапе на карте не списываются и не блокируется средства.
    
2. Подтверждение платежа. Доступно двумя способами:
    
    1. Перенаправление пользователя по ссылке в поле checkout_url из ответа на создание платежа.
        
    2. Путем отправки [запроса на подтверждение платежа](#4db015c3-bf1a-4ea9-a570-dd8c2761c561). В URL необходимо передать полученный в первом запросе uuid-транзакции. Если включен режим безакцептного списания, то необходимо отправить пустое тело запроса, в противном случае - полученный пользователем SMS-код. По результатам исполнения данного запроса с карты клиента списываются средства.
        

### Описание модели платежной транзакции (PaymentModel)

| Поле | Описание | Тип |
| --- | --- | --- |
| uuid | Уникальный ID транзакции | string(36) |
| store_id | ID магазина партнера | integer |
| status | Статус транзакции. Смотри {StatusModel} | enum |
| ps | Платежная система/сервис | enum(uzcard, humo, visa, mastercard, payme, click, ..) |
| store_invoice_id | ID инвойса в системе партнера | string(255) |
| store_details | Детали платежа | string |
| card_token | Токен карты | string |
| card_pan | Маска карты | string |
| billing_id | Уникальный ID транзакции в системе Партнера | string(64) |
| phone | Последние 4 цифры номер телефона клиента | string(12) |
| split | Объект с информацией о расщеплении | object |
| device_details | Объект с информацией об устройстве клиента | object |
| commission_type | Тип комиссии за эквайринг. Up – комиссия взымается поверх переданной суммы (с клиента). Down – комиссия взымается с мерчанта | enum(up, down) |
| payment_amount | Сумма платежа в тийинах (копейках) | integer |
| total_amount | Сумма списания с карты клиента с учетом комиссии в тийинах | integer |
| commission_amount | Сумма комиссии в тийинах | integer |
| otp_hash | В случае необходимости подтверждения платежа не равен null | nullable string |
| ps_uniq_id | Уникальный идентификатор платежа в платежной системе (ref_num, rrn). Указывается в банковской выписке по карте | string |
| ps_response_code | Код ответа платежной системы | string |
| callback_message | Ответ из биллинга партнера (в случае интеграции с биллингом) | string |
| tax | Объект с информацией о фискальном чеке. Ссылка на чек в поле qr_url | object |
| refund_tax | Объект с информацией о возвратном фискальном чеке. Ссылка на чек в поле qr_url | object |
| receipt_url | Ссылка на квитанцию об оплате | string |
| payment_time | Время списания средств с карты клиента | datetime (Y-m-d H:i:s) |
| refund_time | Время возврата | datetime (Y-m-d H:i:s) |
| store | Объект с информацией о магазине партнера | object |
| checkout_url | Ссылка на страницу проведения платежа | string |
| clearing | Объект с информацией о платежном поручении по возмещению на расчетный счет мерчанта | object |

Пример ответа:

``` json
{
    "success": true,
    "data": {
        "status": "draft",
        "ps": "humo",
        "store_id": 6,
        "store_invoice_id": "RB25047997032",
        "store_details": {
            "NDECREE": "RB25047997032",
            "SERVICE_TYPE": "01"
        },
        "card_token": "66b1f7d3565baf001c384f39",
        "card_pan": "409784******3066",
        "phone": "*3929",
        "split": null,
        "multicard_user_id": null,
        "device_details": null,
        "kyc_data": null,
        "callback_url": null,
        "ofd": null,
        "commission_type": "down",
        "terminal_id": "18610VQW",
        "merchant_id": "01200000012000N",
        "payment_amount": 100000,
        "total_amount": 100000,
        "commission_amount": 1500,
        "id": 52311181,
        "uuid": "2b163e87-6d7e-11f0-9a1b-00505680eaf6",
        "ps_uniq_id": null,
        "ps_response_code": null,
        "callback_message": null,
        "payment_time": null,
        "fee_munis": null,
        "refund_time": null,
        "billing_id": null,
        "otp_hash": null,
        "clearing_id": null,
        "tax_receipt_id": null,
        "added_on": "2025-07-31 00:48:30",
        "application": {
            "id": 9,
            "application_id": "multicard_cron",
            "wallet_sum": null,
            "wallet_sender_account": null,
            "wallet_overdraft": 0,
            "wallet_contract_num": null,
            "otp_required": 0,
            "otp_gateway": null,
            "sms_nickname": null,
            "allow_bank_transaction": 1,
            "otp_length": 6,
            "official_name": "Multicard",
            "offer_url": null,
            "phone": null,
            "allow_balance": 0,
            "added_on": "2021-08-12 00:58:02",
            "updated_on": "2025-03-28 21:04:17"
        },
        "store": {
            "id": 6,
            "uuid": "5a394898-d5aa-11ee-a37f-00505680eaf6",
            "category_id": null,
            "merchant_id": 5,
            "note": "путевка (тест)",
            "logo": "https://checkout.multicard.uz/img/favicon.png",
            "color": null,
            "uzum_terminal": "{\n    \"terminal_id\": \"1fb0f2ee-9460-48de-8a5e-3c7c036b394c\",\n    \"merchant_id\": null,\n    \"commission_type\": \"down\",\n    \"commission\": 0,\n    \"interest\": \"0\"\n}",
            "callback_class": null,
            "view_fields": null,
            "tax_registration": 0,
            "tax_mxik": "10204001001000000",
            "tax_package_code": "1500169",
            "tax_commission_recipient_tin": "200799456",
            "budget_category_id": null,
            "repeatable": 0,
            "otp_required": 0,
            "active": 1,
            "sort": 0,
            "cashback": 0,
            "tg_chat_id": null,
            "qr_url": null,
            "bg_img": null,
            "merchant_account_id": null,
            "title": "Multicard",
            "merchant": {
                "id": 5,
                "name": "Тестовый мерчант (Multicard)",
                "tin": "307578794",
                "contract_id": null,
                "bank_account": "00981:29896000900000981002",
                "sender_account": {
                    "ps_external_fee_type": "down",
                    "allow_sms": true,
                    "ps_external_fee_amount": "1.5",
                    "disable_deeplink": true,
                    "sbp_terminal_id": "90C4F76700644424AEBD1249DA2866DB"
                }
            },
            "surcharge": {
                "humo": 0,
                "uzcard": 0,
                "payme": 0,
                "click": 0,
                "uzum": 0,
                "alif": 0,
                "xazna": 0,
                "anorbank": 0,
                "oson": 0,
                "beepul": 0,
                "road24": 0
            },
            "discount": {
                "humo": 0,
                "uzcard": 0,
                "payme": 0,
                "click": 0,
                "uzum": 0,
                "alif": 0,
                "xazna": 0,
                "anorbank": 0,
                "oson": 0,
                "beepul": 0
            },
            "contract": null,
            "merchant_account": null
        },
        "tax": null,
        "refund_tax": null,
        "ps_response_msg": null,
        "receipt_url": null,
        "invoice": null,
        "details": {
            "NDECREE": "RB25047997032",
            "SERVICE_TYPE": "01"
        },
        "clearing": [],
        "bank": null,
        "checkout_url": "https://checkout.multicard.uz/2b163e87-6d7e-11f0-9a1b-00505680eaf6"
    }
}

 ```

### Возможные статусы транзакции (StatusModel)

| **Статус** | **Описание** | **Конечный** |
| --- | --- | --- |
| draft | Транзакция создана, но еще не подтверждена | Нет |
| progress | Транзакция подтверждена, в процессе исполнения | Нет |
| billing | Авторизация успешна, попытка отправки запроса в биллинг Мерчанта | Нет |
| hold | Средства захолдированы (заблокированы) на карте плательщика | Нет |
| success | Успешно | Да |
| error | Ошибка при списании или при отправки запроса в биллинг Мерчанта | Да |
| revert | Осуществлен возврат средств на карту клиента | Да |
