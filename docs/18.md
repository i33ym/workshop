# Добавление карты с помощью карточных данных

## OpenAPI Specification

```yaml
openapi: 3.0.1
info:
  title: ''
  description: ''
  version: 1.0.0
paths:
  /payment/card:
    post:
      summary: Добавление карты с помощью карточных данных
      deprecated: false
      description: >-
        Метод отправляет SMS-код на номер телефон держателя карты. Отправленный
        код необходимо передать в методе подтверждения привязки.

        Метод доступен только для партнеров, которых имеется сертификат PCI DSS.
      tags:
        - Привязка карт (API)
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                pan:
                  type: string
                  description: Номер карты (Uzcard или Humo)
                expiry:
                  type: string
                  description: Срок действия карты (yymm)
                user_phone:
                  type: string
                  description: >-
                    Номер телефона пользователя в формате 998XXXXXXXXX.
                    Обязателен для карт Humo. Если передан, то будет проверено
                    соответствие с номер смс-информаирования на карте (для
                    Uzcard/Humo)
                cvc:
                  type: string
                holder_name:
                  type: string
                session_id:
                  type: string
                pinfl:
                  type: string
                  description: >-
                    ПИНФЛ клиента. Если передан, то будет осуществлена проверка
                    на принадлежность карты к данному лицу (только для
                    Uzcard/Humo)
                  minLength: 14
                  maxLength: 14
              required:
                - pan
                - expiry
                - user_phone
              x-apidog-orders:
                - pan
                - expiry
                - user_phone
                - cvc
                - holder_name
                - session_id
                - pinfl
              x-apidog-ignore-properties: []
            example:
              pan: '8600303655375959'
              expiry: '2603'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                      application_id:
                        type: integer
                        description: >-
                          Идентификатор приложения, выданный со стороны
                          Multicard
                      payer_id:
                        type: 'null'
                        description: >-
                          Значение поля session_id из ответа на запрос привязки
                          карты
                      card_pan:
                        type: string
                        description: |-
                          Max length:16
                          Маскированный номер карты
                      card_token:
                        type: string
                        description: |-
                          Max length:255
                          Токен карты для проведения платежных операций с картой
                      phone:
                        type: 'null'
                        description: >-
                          Max length:12

                          Телефон держателя карты в формате 998XXXXXXXXX
                          (поддерживается только для карт Uzcard и Humo)
                      holder_name:
                        type: 'null'
                        description: Имя и фамилия владельца карты
                      pinfl:
                        type: 'null'
                        description: >-
                          ПИНФЛ держателя карты (возвращается в случае передачи
                          в запросе на создание привязки для карт Uzcard и Humo)

                          Max length:14
                      ps:
                        type: string
                        description: |-
                          Allowed values (5)
                          uzcard,
                          humo,
                          visa,
                          mastercard,
                          unionpay
                          hide all
                          Платежная система
                      status:
                        $ref: '#/components/schemas/PaymentStatusEnum'
                      added_on:
                        type: string
                        description: Время добавления карты в формате YYYY-mm-dd H:i:s
                      card_status:
                        type: 'null'
                      sms_inform:
                        type: 'null'
                    required:
                      - id
                      - application_id
                      - payer_id
                      - card_pan
                      - card_token
                      - phone
                      - holder_name
                      - pinfl
                      - ps
                      - status
                      - added_on
                      - card_status
                      - sms_inform
                    x-apidog-orders:
                      - id
                      - application_id
                      - payer_id
                      - card_pan
                      - card_token
                      - phone
                      - holder_name
                      - pinfl
                      - ps
                      - status
                      - added_on
                      - card_status
                      - sms_inform
                    x-apidog-ignore-properties: []
                required:
                  - success
                  - data
                x-apidog-orders:
                  - success
                  - data
                x-apidog-ignore-properties: []
              example:
                success: true
                data:
                  id: 55
                  application_id: 1
                  payer_id: null
                  card_pan: 409784******3066
                  card_token: 6225f3c93f7a110142782fa4
                  phone: null
                  holder_name: null
                  pinfl: null
                  ps: uzcard
                  status: draft
                  added_on: '2022-04-21 14:36:29'
                  card_status: null
                  sms_inform: null
          headers: {}
          x-apidog-name: Успешно
        '400':
          description: >-
            При попытке добавления карты с не подключенным SMS информированием,
            система возвращает ошибку с кодом 400, и сообщает клиенту об ошибке
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 'Статус запроса '
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        description: Кодовое сообщение
                      details:
                        type: string
                        description: Описание ошибки
                    required:
                      - code
                      - details
                    x-apidog-orders:
                      - code
                      - details
                    description: Ошибка
                    x-apidog-ignore-properties: []
                required:
                  - success
                  - error
                x-apidog-orders:
                  - success
                  - error
                x-apidog-ignore-properties: []
              example:
                success: false
                error:
                  code: ERROR_CARD_SMS
                  details: На карте 986027******1519 не подключено SMS-информирование
          headers: {}
          x-apidog-name: Не подключено SMS-информирование
        '429':
          description: >-
            При повторной отправки запроса на SMS пароль, система возвращает
            ошибку с кодом 400, и клиент получает сообщение об ошибке
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 'Статус запроса '
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        description: Кодовое сообщение
                      details:
                        type: string
                        description: Описание ошибки
                    required:
                      - code
                      - details
                    x-apidog-orders:
                      - code
                      - details
                    description: Ошибка
                    x-apidog-ignore-properties: []
                required:
                  - success
                  - error
                x-apidog-orders:
                  - success
                  - error
                x-apidog-ignore-properties: []
              example:
                success: false
                error:
                  code: ERROR_SMS_ALREADY_SENT
                  details: >-
                    SMS с кодом уже отправлено: дождитесь его получения, либо
                    попробуйте позже через 2 минуты
          headers: {}
          x-apidog-name: SMS уже отправлено
        'x-400:Запрос с некорректным номером карты или срока действия ':
          description: >-
            При попытке добавления карты с неправильным номером, или сроком
            действия система возвращает ошибку с кодом 400, и сообщает клиенту
            об ошибке
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 'Статус запроса '
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        description: Кодовое сообщение
                      details:
                        type: string
                        description: Описание ошибки
                    required:
                      - code
                      - details
                    x-apidog-orders:
                      - code
                      - details
                    description: Ошибка
                    x-apidog-ignore-properties: []
                required:
                  - success
                  - error
                x-apidog-orders:
                  - success
                  - error
                x-apidog-ignore-properties: []
              example:
                success: false
                error:
                  code: ERROR_CARD_NOT_FOUND
                  details: Неверный номер карты или срок действия
          headers: {}
          x-apidog-name: 'Запрос с некорректным номером карты или срока действия '
        x-400:Запрос с неподдерживаемой картой:
          description: >-
            При попытке добавления неподдерживаемой карты , система возвращает
            ошибку с кодом 400, и сообщает клиенту об ошибке
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 'Статус запроса '
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        description: Кодовое сообщение
                      details:
                        type: string
                        description: Описание ошибки
                    required:
                      - code
                      - details
                    x-apidog-orders:
                      - code
                      - details
                    description: Ошибка
                    x-apidog-ignore-properties: []
                required:
                  - success
                  - error
                x-apidog-orders:
                  - success
                  - error
                x-apidog-ignore-properties: []
              example:
                success: false
                error:
                  code: CARD_NOT_SUPPORTED
                  details: >-
                    Транзакции с данного типа счета/карты/сервиса не
                    поддерживаются
          headers: {}
          x-apidog-name: Запрос с неподдерживаемой картой
        x-400:Ошибочная валидация:
          description: >-
            При отправке запроса с допущением ошибки валидации, возвращается
            ошибка с кодом 400
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Статус запроса
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        description: Кодовое сообщение
                      details:
                        type: string
                        description: Описание ошибки
                    required:
                      - code
                      - details
                    x-apidog-orders:
                      - code
                      - details
                    description: Ошибка
                    x-apidog-ignore-properties: []
                required:
                  - success
                  - error
                x-apidog-orders:
                  - success
                  - error
                x-apidog-ignore-properties: []
              example:
                success: false
                error:
                  code: ERROR_FIELDS
                  details: >-
                    Отсутствуют обязательные поля (pan, expiry) или у приложения
                    нет доступа
          headers: {}
          x-apidog-name: Ошибочная валидация
      security: []
      x-apidog-folder: Привязка карт (API)
      x-apidog-status: released
      x-run-in-apidog: https://app.apidog.com/web/project/1022226/apis/api-19729308-run
components:
  schemas:
    PaymentStatusEnum:
      type: string
      enum:
        - draft
        - progress
        - billing
        - success
        - error
        - revert
      x-apidog-enum:
        - value: draft
          name: ''
          description: транзакция не подтверждена
        - value: progress
          name: ''
          description: транзакция в процессе списания в платежной системе
        - value: billing
          name: ''
          description: идет отправка запроса в биллинг поставщика
        - value: success
          name: ''
          description: успешно
        - value: error
          name: ''
          description: >-
            ошибка при списании или отправки запроса в биллинг поставщика.
            транзакция не успешна
        - value: revert
          name: ''
          description: возврат
      x-apidog-folder: ''
  securitySchemes:
    bearer:
      type: http
      scheme: bearer
servers: []
security:
  - bearer: []

```
